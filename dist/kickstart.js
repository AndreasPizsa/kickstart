// Generated by CoffeeScript 1.6.2
(function() {
  var _;

  _ = require('lodash');

  module.exports = function(options) {
    var env, mod, path, pkgname, rootModule, _i, _len, _ref;

    env = _.extend({
      _: _
    }, options);
    path = require('path');
    rootModule = module;
    while (rootModule.parent) {
      rootModule = rootModule.parent;
    }
    env.rootDir = path.dirname(rootModule.filename);
    pkgname = path.join(env.rootDir, 'package.json');
    env.pkginfo = require(pkgname);
    env.use = function(name) {
      return _.extend({}, require(name)(env), env);
    };
    if (_.isString(env.uses)) {
      env.uses = env.uses.split(' ');
    }
    if (!_.isArray(env.uses)) {
      env.uses = [env.uses];
    }
    _ref = env.uses;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      mod = _ref[_i];
      env = env.use("kickstart-" + mod);
    }
    return env;
  };

}).call(this);
